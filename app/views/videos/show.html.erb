<div class="row">
  <div class="col-lg-10">
    <p id="notice"><%= notice %></p>
    <p>
      <strong>Title:</strong>
      <%= @video.title %>
    </p>

    <p>
      <strong>Clip Key:</strong>
      <%= @video.clip.id %>
    </p>

    <p>
      <strong>Description:</strong>
      <%= @video.description %>
    </p>

    <p>
      <strong>Duration:</strong>
      <%= @video.duration %>
    </p>


    <p>
      <strong>Approved:</strong>
      <%= @video.approved %>
    </p>

    <p>
      <strong>Public:</strong>
      <%= @video.public %>
    </p>

    <p>
      <strong>Video Size:</strong>
      <%= number_to_human_size(@video.clip.size) %>
    </p>

    <p>
      <strong>Balance:</strong>
      <%= @video.balance %>
    </p>

    <p>
      <strong>Views:</strong>
      <%= @video.views %>
    </p>

    <!-- <p>
      <strong>URL:</strong>
      <%#= @video.secret_url %>
    </p> -->
    <% if Rails.env == 'development' %>
      <p>
        <strong>URL:</strong>
        <%= @video.clip.url %>
      </p>
    <% end %>

    <div class="minutes-balance">
      <span class="balance-span">Browzable <%= link_to number_to_human(current_user.account.balance / 60), 
        root_path, class: "icon-link" %></span>
    </div>
  </div>
</div>

<%= content_tag :div, "", class: "browzable-wrapper", data: { url: @video.clip.url, video_id: @video.id } do %>
  <div id="browzable-video"></div>
<% end %>

<%#= video_tag @video.clip.url, controls: true %>
<%#= video_tag @video.secret_url, width: 640, controls: true %>
<%= link_to 'Edit', edit_video_path(@video) %> |
<%= link_to 'Back', videos_path %>


<script type="text/javaScript">
  
  var wrapper = document.querySelector(".browzable-wrapper");
  var url = wrapper.dataset.url;
  var videoId = wrapper.dataset.videoId;
  var playerInstance = jwplayer("browzable-video");
  var email = $(".minutes-balance");
  var playDuration = 10;

  playerInstance.setup({
      file: url
  });

  // Embed JWplayer

  jwplayer().on('ready', function() {
    $(".jw-spacer").addClass("br-info")
    $(".br-info").append(email);
    email.show();
  });

  //inaccurate timekeeping

  var counter = 0;
  var prevPosition = 0;

  jwplayer().on('time', function(time) {
    counter += time.position - prevPosition;
    console.log(counter);
    prevPosition = time.position;
    if (counter > playDuration) {
      sendPlay();
      counter -= playDuration;
    }
  });

  jwplayer().on('seeked', function() {
    counter = 0;
  })

  //post to server

  function sendPlay() {
    var playData = { play: {video_id: videoId, duration: playDuration} }
    console.log(playData);
    var request = $.ajax({
      url: "/plays",
      method: "POST",
      data: playData,
      dataType: "html"
    });

    request.done(function( msg ) {
      console.log(msg);
    });
  }
  
  
</script>


