<h1>Editing Video</h1>
<div class="row">
  <div class="col-lg-6">
    <%= form_with(model: @video, local: true) do |form| %>

      <div class="form-group">
        <%= form.label :title %>
        <%= form.text_field :title, class: "form-control" %>
      </div>
      <div class="form-group">
        <%= form.label :description %>
        <%= form.text_area :description, class: "form-control" %>
      </div>
      <div class="form-check form-check-inline">
        <%= form.label :public, "show", class: "form-check-label" do %>
          <%= form.radio_button :public, true, class: "form-check-input" %> Public
        <% end %>
      </div>
      <div class="form-check, form-check-inline">
        <%= form.label :public, "hide", class: "form-check-label" do %>  
          <%= form.radio_button :public, false, class: "form-check-input" %> Private
        <% end %>
      </div>
      <div class="form-group">
        
        <%= form.label :image, "Preview Image" %>
        <div class="preview-image">
          <% if @video.image %>
            <%= cl_image_tag(@video.image, width: 200) %>
          <% end %>
        </div>
        <br><%= cl_image_upload_tag(:image_id) %>
      </div>
      <div class="form-group">
        <%= form.submit "Update", class: "btn btn-primary" %>
      </div>
    <% end %>
  </div>
</div>

<%= link_to 'Show', @video %> |
<%= link_to 'Back', videos_path %>

<%= cloudinary_js_config %>
<script>
  $(function() {
    if($.fn.cloudinary_fileupload !== undefined) {
      $("input.cloudinary-fileupload[type=file]").cloudinary_fileupload({
        
        // add: function(e, data) {
        //   console.log("add: ", data);
        //   $(".preview-image").html(data.files[0].name);
        // }

        // progress: function(e, data) {
        //   console.log("progress: ", data);
        // }, 

        // done: function(e, data) {
        //   console.log("done: ", data);
        //   $(".preview-image").html("<img src='https://picsum.photos/200'>");
        // },

        // fail: function(e, data) {
        //   console.log(data);
        // }
      });

      $('.cloudinary-fileupload').bind('fileuploadprogress', function(e, data) { 
        console.log(data);
        $(".preview-image").html(data.files[0].name);
      });

      $('.cloudinary-fileupload').bind('cloudinarydone', function(e, data) {  
        var id = data.result.public_id;
        var format = data.result.format;
        var version = data.result.version;
        var url = "http://res.cloudinary.com/eli/image/upload/w_200/v" + version + "/" + id + "." + format;
        $(".preview-image").html("<img src=" + url + ">");
        console.log(id, format, version, url);
      });

    }
  });
</script>